# RTMP ‚Üí RTSP –ö–æ–Ω–≤–µ—Ä—Ç–µ—Ä

## üß† –û–ø–∏—Å–∞–Ω–∏–µ

–≠—Ç–æ—Ç –ø—Ä–æ–µ–∫—Ç ‚Äî –∫–æ–Ω–≤–µ—Ä—Ç–µ—Ä –≤–∏–¥–µ–æ–ø–æ—Ç–æ–∫–æ–≤ –∏–∑ RTMP –≤ RTSP. –û–Ω –ø–æ–∑–≤–æ–ª—è–µ—Ç –ø–æ–ª—É—á–∞—Ç—å RTMP-–ø–æ—Ç–æ–∫–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, —Å –¥—Ä–æ–Ω–æ–≤ –∏–ª–∏ OBS), —Ç—Ä–∞–Ω—Å–ª–∏—Ä–æ–≤–∞—Ç—å –∏—Ö –≤ RTP (—á–µ—Ä–µ–∑ ffmpeg), –∞ –∑–∞—Ç–µ–º –ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å –∫–∞–∫ RTSP-–ø–æ—Ç–æ–∫–∏ (—á–µ—Ä–µ–∑ Python-–±–∏–±–ª–∏–æ—Ç–µ–∫—É `aiortc`).

–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è **–æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–∞—è —Ç—Ä–∞–Ω—Å–ª—è—Ü–∏—è –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –ø–æ—Ç–æ–∫–æ–≤**, —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—Å—É—â–µ—Å—Ç–≤–ª—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ HTTP API.

---

## ‚öôÔ∏è –¢–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ –∑–∞–¥–∞–Ω–∏–µ

**–ó–∞–¥–∞—á–∞**: –≤–æ –º–Ω–æ–≥–∏—Ö —Å–∏—Å—Ç–µ–º–∞—Ö –≤–∏–¥–µ–æ–ø–æ—Ç–æ–∫ –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ RTMP, –æ–¥–Ω–∞–∫–æ –ø—Ä–∏–Ω–∏–º–∞—é—â–∞—è —Å–∏—Å—Ç–µ–º–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ —Å RTSP. –ù–µ–æ–±—Ö–æ–¥–∏–º–æ —Ä–∞–∑—Ä–∞–±–æ—Ç–∞—Ç—å —Å–µ—Ä–≤–∏—Å, –∫–æ—Ç–æ—Ä—ã–π:
- –ø—Ä–∏–Ω–∏–º–∞–µ—Ç RTMP-–ø–æ—Ç–æ–∫–∏
- —Ç—Ä–∞–Ω—Å–ª–∏—Ä—É–µ—Ç –∏—Ö –≤ RTP
- –ø—É–±–ª–∏–∫—É–µ—Ç –∏—Ö –∫–∞–∫ RTSP-–ø–æ—Ç–æ–∫–∏

---

## üì¶ –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

### –£—Å—Ç–∞–Ω–æ–≤–∏:

- Python 3.9+ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è 3.10 –∏–ª–∏ 3.11)
- ffmpeg (–¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –¥–æ—Å—Ç—É–ø–µ–Ω –≤ `PATH`)
- pip –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:

```bash
pip install -r requirements.txt
```

## –£—Å—Ç–∞–Ω–æ–≤–∫–∞ ffmpeg

–°–∫–∞—á–∞–π —Å https://ffmpeg.org/download.html
–ù–∞ Windows –ø–æ–ª–æ–∂–∏ ffmpeg.exe –≤ C:/ffmpeg –∏ –¥–æ–±–∞–≤—å C:/ffmpeg/bin –≤ —Å–∏—Å—Ç–µ–º–Ω—É—é –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é PATH.

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞
```bash
.
‚îú‚îÄ‚îÄ rtmp2rtp.py        # –ü–æ–ª—É—á–∞–µ—Ç RTMP ‚Üí RTP
‚îú‚îÄ‚îÄ rtsp_server.py     # –ü—É–±–ª–∏–∫—É–µ—Ç RTP ‚Üí RTSP
‚îú‚îÄ‚îÄ requirements.txt
‚îî‚îÄ‚îÄ README.md
```

## üöÄ –ö–∞–∫ –∑–∞–ø—É—Å—Ç–∏—Ç—å

–í —Ñ–∞–π–ª–µ rtmp2rtp.py —É–∫–∞–∑–∞—Ç—å –ø—É—Ç—å –∫ ffmpeg
line 7: 

```py
ffmpeg_path = "C:/ffmpeg/ffmpeg.exe"  # –ø—É—Ç—å –∫ ffmpeg
```

### 1. –ó–∞–ø—É—Å–∫ RTMP ‚Üí RTP —Ä–µ—Ç—Ä–∞–Ω—Å–ª—è—Ç–æ—Ä–∞
```bash
python rtmp2rtp.py
```

### üì• –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –ø–æ—Ç–æ–∫ RTMP –ø—Ä–∏–Ω–∏–º–∞–µ—Ç—Å—è –ø–æ –∞–¥—Ä–µ—Å—É:
```bash
rtmp://<–≤–∞—à_—Å–µ—Ä–≤–µ—Ä>/stream/<stream_key>
```

üéØ –û–Ω –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –≤ RTP (–ø–æ—Ä—Ç –ø–æ–¥–±–∏—Ä–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏) –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ —Å–ª–æ–≤–∞—Ä—å –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø–æ—Ç–æ–∫–æ–≤.



–ü—Ä–∏–º–µ—Ä—ã API:

  –ù–∞—á–∞—Ç—å –ø—Ä–∏—ë–º –ø–æ—Ç–æ–∫–∞:
```bash
curl -X POST http://localhost:8080/start -H "Content-Type: application/json" -d '{"stream_key": "stream"}'
```
  –ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø–æ—Ç–æ–∫–æ–≤:
```bash
curl http://localhost:8080/streams
```
  –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø–æ—Ç–æ–∫:
```bash
curl -X POST http://localhost:8080/stop -H "Content-Type: application/json" -d '{"stream_key": "stream2"}'
```

### 2. –ó–∞–ø—É—Å–∫ RTSP-—Å–µ—Ä–≤–µ—Ä–∞
```bash
python rtsp_server.py
```
RTSP-—Å–µ—Ä–≤–µ—Ä –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –Ω–∞ `rtsp://localhost:8554/<stream_key>`
–ü—Ä–∏–º–µ—Ä –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è:
```bash
ffplay rtsp://localhost:8554/<stream_key>
```
–ò–ª–∏ –≤ VLC:

Media ‚Üí Open Network Stream ‚Üí `rtsp://localhost:8554/<stream_key>`

### –ü—Ä–∏–º–µ—á–∞–Ω–∏–µ: 
–ì—Ä—É–±–æ –º–µ–Ω—è–µ–º—ã–µ –ø–æ—Ä—Ç—ã –Ω–∞ RTSP-—Å–µ—Ä–≤–µ—Ä–µ(–ø–æ—Ä—Ç—ã –∏ –∫–ª—é—á–∏ –Ω—É–∂–Ω–æ –ø—Ä–æ–ø–∏—Å—ã–≤–∞—Ç—å –≤—Ä—É—á–Ω—É—é)



## üß¨ –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ–Ω–≤–µ—Ä—Ç–µ—Ä

  ### üì° rtmp2rtp.py –∑–∞–ø—É—Å–∫–∞–µ—Ç ffmpeg –¥–ª—è –∫–∞–∂–¥–æ–≥–æ RTMP-–ø–æ—Ç–æ–∫–∞:
  
  1) ffmpeg —á–∏—Ç–∞–µ—Ç RTMP-–ø–æ—Ç–æ–∫

  2) —Ç—Ä–∞–Ω—Å–ª–∏—Ä—É–µ—Ç –µ–≥–æ –≤ RTP

  3) ffmpeg –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –≤–∏–¥–µ–æ –ø–æ UDP –Ω–∞ –ø–æ—Ä—Ç 5000+N

  ### üõ∞Ô∏è rtsp_server.py –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –±–∏–±–ª–∏–æ—Ç–µ–∫—É aiortc, —á—Ç–æ–±—ã:

  4) —Å–ª—É—à–∞—Ç—å –ø–æ—Ä—Ç—ã RTP

  5) —Ä–∞–∑–¥–∞–≤–∞—Ç—å –ø–æ—Ç–æ–∫–∏ —á–µ—Ä–µ–∑ RTSP (WebRTC –ø–æ–≤–µ—Ä—Ö RTSP)

  ### üí° –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—Å—É—â–µ—Å—Ç–≤–ª—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ HTTP API:

  6) –∑–∞–ø—É—Å–∫/–æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø–æ—Ç–æ–∫–∞

  7) –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø–æ—Ç–æ–∫–æ–≤

## üìå –ü—Ä–∏–º–µ—á–∞–Ω–∏—è

  * –ü–æ—Ç–æ–∫–∏ RTMP –¥–æ–ª–∂–Ω—ã –ø–æ—Å—Ç—É–ø–∞—Ç—å –≤ —Ñ–æ—Ä–º–∞—Ç–µ H264 + AAC

  * –ö–∞–∂–¥—ã–π –ø–æ—Ç–æ–∫ –ø–æ–ª—É—á–∞–µ—Ç —É–Ω–∏–∫–∞–ª—å–Ω—ã–π RTP –ø–æ—Ä—Ç (–Ω–∞–ø—Ä–∏–º–µ—Ä, 5004, 5006, 5008 –∏ —Ç.–¥.)

 *  –°–∏—Å—Ç–µ–º–∞ –ª–æ–≥–∏—Ä—É–µ—Ç –¥–µ–π—Å—Ç–≤–∏—è –∏ –æ—à–∏–±–∫–∏

## üìà –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

* RTMP ‚Üí RTP —Ç—Ä–∞–Ω—Å–ª—è—Ü–∏—è

* RTP ‚Üí RTSP –ø—É–±–ª–∏–∫–∞—Ü–∏—è

* –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –ø–æ—Ç–æ–∫–æ–≤ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ

* HTTP API –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è

* –ü—Ä–æ—Å—Ç–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–Ω—É—é –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É

* –ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å —Å Docker

## üìÆ –ê–≤—Ç–æ—Ä—ã

### –†–∞–∑—Ä–∞–±–æ—Ç–∞–Ω–æ –≤ —Ä–∞–º–∫–∞—Ö —Ö–∞–∫–∞—Ç–æ–Ω–∞ ü§ñ
–°–≤—è–∑—å: kadyrovdias8b@gmail.com; tg: @itadakimashita
